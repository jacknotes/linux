--酒店销售单供应商来源
select profitsource,* from Topway..tbHtlcoupYf 
--update Topway..tbHtlcoupYf  set profitsource='携程官网分销联盟'
where CoupNo='PTW083910'

select idno,* from Topway..tbcash c
left join homsomDB..Trv_Human h on h
where coupno='AS002488145'
select * from homsomDB..Trv_DomesticTicketRecord where RecordNumber='AS002488145'
select top 100 * from homsomDB..Trv_Human 
select top 100 * from homsomDB..Trv_Passengers where UPType='个人'

select * from Topway..CompanyInvoiceInfoDetail where InvoicesTitle='恒顺旅行(测试单位)'

--UC020456，除了负责人、经办人保留 删除员工
select * from homsomDB..Trv_Human 
--update homsomDB..Trv_Human set IsDisplay=0
where ID in (Select ID from homsomDB..Trv_UnitPersons
where CompanyID=(Select ID from homsomDB..Trv_UnitCompanies
where Cmpid='020456')) and IsDisplay=1
and Name not in ('施碧莹','陈昌楣','曹昕月')

select * from Topway..tbCusholderM 
--update Topway..tbCusholderM set EmployeeStatus=0
where cmpid='020456' 
and custname not in ('施碧莹','陈昌楣','曹昕月')

--修改到账审核状态
select state,* from Topway..FinanceERP_ClientBankRealIncomeDetail 
--update Topway..FinanceERP_ClientBankRealIncomeDetail  set state=5
where money='88886' and date='2019-05-15'

--行程单
select info3,* from Topway..tbcash
--update Topway..tbcash set info3='需打印中文行程单' 
where coupno in('AS002377677','AS002377677','AS002377677','AS002377672','AS002377672','AS002377670','AS002374789','AS002374784','AS002374784',
'AS002374783','AS002374783','AS002392167','AS002430050','AS002430043','AS002479624','AS002519257','AS002517402','AS002517402','AS002517402',
'AS002517401','AS002517401','AS002517401','AS002516652')
and ticketno not in('3679393364','7300972037','7300972040','9577020116','9577020114','9577020115','9578159503')


--修改报销销售单价
select price,totprice,amount,owe,profit,* from Topway..tbcash 
--update Topway..tbcash  set price=3,totprice=3,amount=3,owe=3,profit=profit-27
where coupno in('AS002446110',
'AS002446114',
'AS002451920',
'AS002451990',
'AS002452000',
'AS002455601',
'AS002455614',
'AS002455624',
'AS002455636',
'AS002457763',
'AS002466736',
'AS002466743',
'AS002474442',
'AS002474447',
'AS002515404',
'AS002515410',
'AS002515414')

--账单撤销
select SubmitState,* from Topway..AccountStatement 
--update Topway..AccountStatement  set SubmitState=1
where BillNumber='016707_20190501'

/*
查询要素
     1、业务类型：国际
     2、承运人：LH 
     3、供应商来源：不限
     4、出票日期1：2018年1月-2018年12月
         出票日期2：2019年1月-2019年4月
     5、扣除退票
    
     报表要素1
     销售单号、供应商来源、票号、行程中包含CPH/HEL/OSL/STO/ARN/GOT/REK、舱位、文件价合计 
 
     报表要素2
     销售单号、供应商来源、票号、行程、舱位、文件价合计  
*/

select coupno 销售单号,t_source 供应商来源,tcode+ticketno 票号,route 行程,nclass 舱位,sprice1+sprice2+sprice3+sprice4 文件价合计
from Topway..tbcash 
where inf=1
and ride='LH'
and reti=''
and (route like '%CPH%' or route like '%HEL%' or route like '%OSL%' or route like '%STO%' or route like '%ARN%' or route like '%GOT%' or route like '%REK%')
and datetime>='2018-01-01'
and datetime<'2019-01-01'
order by datetime

select coupno 销售单号,t_source 供应商来源,tcode+ticketno 票号,route 行程,nclass 舱位,sprice1+sprice2+sprice3+sprice4 文件价合计
from Topway..tbcash 
where inf=1
and ride='LH'
and reti=''
and datetime>='2019-01-01'
and datetime<'2019-05-01'
order by datetime


--OA流程修改
select * from ApproveBase..App_DefineBase 
--update ApproveBase..App_DefineBase  set AppName='机票业务--（产品部专用）修改退票状态或退票审核日期（国内）',AppDesc='(1)修改退票状态：退票单号、审核日期、原退票状态、现退票状态、结算状态   (2)修改退票审核日期：退票单号、原退票审核日期、现退票审核日期、结算状态'
where AppNo='WF0085'

select * from ApproveBase..App_DefineBase 
--update ApproveBase..App_DefineBase  set AppName='机票业务--（产品部专用）修改退票状态或退票审核日期（国际）',AppDesc='(1)修改退票状态：退票单号、审核日期、原退票状态、现退票状态、结算状态   (2)修改退票审核日期：退票单号、原退票审核日期、现退票审核日期、结算状态'
where AppNo='WF0086'


SELECT * FROM ApproveBase..B_DataModify_ModifyContent 
--update ApproveBase..B_DataModify_ModifyContent  set ModifyContent='（产品部专用）修改退票状态或退票审核日期（国内）'
where ID='47'

SELECT * FROM ApproveBase..B_DataModify_ModifyContent 
--update ApproveBase..B_DataModify_ModifyContent  set ModifyContent='（产品部专用）修改退票状态或退票审核日期（国际）'
where ID='48'

/*
麻烦这份表格除了如下数据，再帮忙添加一些数据，非常感谢！
公司名称，
差旅顾问，
运营经理，
国内利润金额，
国内利润率，
该UC号所有的常旅客，
该UC号2018年6月1日-2019年5月31日出过国内机票的常旅客人数，
该UC号2017年6月1日-2019年5月31日出过国内机票的常旅客人数，
该司MU和FM的国内S V T Z舱出票销量站国内总销量占比。
*/

select cmpcode UC号,Name 公司名称,t1.TcName 差旅顾问,t2.MaintainName 运营经理,SUM(totprice) 国内销量,SUM(originalprice-price) 国内申请费金额,SUM(profit) 国内利润金额,
SUM(profit)/SUM(totprice) 国内利润率,COUNT(1 )出票张数
from Topway..tbcash c
left join homsomDB..Trv_UnitCompanies un on un.Cmpid=c.cmpcode
left join Topway..HM_AgreementCompanyTC t1 on t1.Cmpid=c.cmpcode and t1.isDisplay=0 and t1.TcType=0
left join Topway..HM_ThePreservationOfHumanInformation t2 on t2.CmpId=c.cmpcode and t2.IsDisplay=1 and MaintainType=9
where CertificateD=2
and inf=0
and ride in('FM','mu')
and datetime>='2018-07-01'
and datetime<'2019-06-10'
--and tickettype='电子票'
group by cmpcode,Name,t1.TcName,t2.MaintainName 
order by 国内销量


--该UC号所有的常旅客
if OBJECT_ID('tempdb..#clk') is not null drop table #clk
select Cmpid UC号,COUNT(1)
--into #clk
from homsomDB..Trv_Human h
left join homsomDB..Trv_UnitPersons u on u.ID=h.ID
left join homsomDB..Trv_UnitCompanies un on un.ID=u.CompanyID
--left join homsomDB..Trv_Credentials cr on cr.HumanID=h.ID
where Cmpid in ('019892','020057','019708','019731','020110','018714','019640','020475','019656','020174','020470','020829','019833','020770','020702','017886','020191','020820','019023','019886','020776',
'020069','020704','020517','020445','020444','019854','016777','020645','020757','019393','019733','019592','019853','019901','018385''020737','019191','020214','020546','020535','017671','019794',
'018993','020207','019134','017909','017873','020162','013184','017623','020839','020533','020233','020472','020438','020825','019059','020169','020461','017458','020586','019436','019071','020675','019998','016911',
'017872','020190','018483','017202','020522','017939','020558','020754','020268','017850','020147','020199','018538','020859','020733','017146','018937','020567','019764','020715','019463',
'020290','020377','020745','019551','019834','020442','020395','018232','017667','020532','020598','019907','020775','020746','020271','020799','019623','020753','019520','020187','018938','020626',
'020143',
'020716',
'020790',
'020434',
'016676',
'020707',
'020559',
'019804',
'017542',
'020000',
'020771',
'019235',
'020243',
'016586',
'020703',
'017519',
'017893',
'020394',
'020835',
'019735',
'019097',
'020482',
'020728',
'017504',
'020731',
'020817',
'016559',
'020635',
'020719',
'020671',
'018017',
'020670',
'020793',
'020705',
'020732',
'002045',
'019423',
'020774',
'018758',
'019409',
'020154',
'019674',
'020555',
'017983',
'020283',
'019476',
'016883',
'018522',
'019609',
'020224',
'020741',
'019273',
'017931',
'019628',
'018539',
'018314',
'020253',
'019878',
'020228',
'020747',
'020592',
'018731',
'019701',
'020124',
'019670',
'019261',
'020447',
'020734',
'018940',
'019365',
'019461',
'016670',
'018343',
'019587',
'017822',
'019258',
'018676',
'017919',
'020538',
'017954',
'016492',
'019180',
'019348',
'020763',
'020786',
'018281',
'018719',
'020141',
'018412',
'020690',
'019442',
'017319',
'019462',
'019651',
'017687',
'017577',
'018790',
'020701',
'019110',
'019638',
'018546',
'017595',
'019568',
'018141',
'020547',
'017173',
'019227',
'020117',
'020128',
'018400',
'016724',
'017999',
'016284',
'018345',
'020401',
'017988',
'017300',
'020640',
'020036',
'015717',
'020708',
'018256',
'020219',
'020133',
'020709',
'018892',
'019721',
'018047',
'017932',
'007638',
'019584',
'020060',
'020195',
'020801',
'018930',
'016556',
'017654',
'019158',
'016339',
'020181',
'017559',
'018061',
'020496',
'019951',
'018726',
'019381',
'020729',
'020723',
'017007',
'020212',
'019717',
'019448',
'019978',
'020736',
'016719',
'020027',
'019021',
'020564',
'017955',
'019862',
'018827',
'020111',
'019897',
'016420',
'020591',
'020095',
'018418',
'020588',
'017016',
'019465',
'019919',
'019934',
'019970',
'018415',
'016490',
'017055',
'020114',
'018756',
'020468',
'020730',
'019757',
'019975',
'020189',
'020631',
'018669',
'020742',
'016348',
'016635',
'017924',
'020651',
'018902',
'019979',
'020327',
'018002',
'016504',
'020256',
'020711',
'019796',
'019863',
'020466',
'020579',
'018652',
'020202',
'018574',
'019859',
'017663',
'019205',
'020293',
'019817',
'020726',
'016379',
'019961',
'019771',
'019882',
'018690',
'020556',
'018367',
'017376',
'016264',
'017930',
'019089',
'019948',
'006944',
'019641',
'020294',
'020087',
'019349',
'020003',
'019506',
'019713',
'018362',
'020112',
'017065',
'017449',
'017921',
'016316',
'020304',
'020161',
'018834',
'020695',
'019072',
'019600',
'020787',
'020541',
'019712',
'019270',
'020317',
'018615',
'018671',
'020544',
'017273',
'020119',
'017682',
'017200',
'019230',
'020663',
'016617',
'019603',
'020165',
'020350',
'017740',
'019152',
'020456',
'019989',
'019284',
'018326',
'020561',
'020072',
'020467',
'016294',
'018134',
'016640',
'018536',
'018570',
'019784',
'020614',
'020575',
'018176',
'016497',
'016426',
'018926',
'016610',
'018103',
'019990',
'019844',
'020370',
'017661',
'020450',
'020364',
'019855',
'016751',
'018626',
'020115',
'016795',
'018037',
'019086',
'014412',
'017012',
'016689',
'020166',
'020717',
'020016',
'017956',
'019366',
'018766',
'016646',
'020553',
'020777',
'017020',
'020497',
'018108',
'020761',
'019629',
'020491',
'020656',
'018490',
'017327',
'016465',
'016477',
'019177',
'019772',
'016363',
'016289',
'017865',
'020061',
'020062',
'018395',
'018608',
'020630',
'019054',
'016354',
'020476',
'018560',
'018357',
'017495',
'020183',
'019450',
'020132',
'017033',
'017700',
'020138',
'020192',
'020084',
'018487',
'019997',
'020413',
'018939',
'016532',
'020053',
'020022',
'018822',
'017153',
'018202',
'020338',
'018634',
'019780',
'019939',
'017122',
'020699',
'019195',
'017193',
'020441',
'020694',
'016179',
'020287',
'020238',
'019455',
'019827',
'017493',
'016773',
'020231',
'016400',
'019219',
'019362',
'000126',
'020266',
'017399',
'016991',
'018773',
'020646',
'020507',
'020067',
'019958',
'020769',
'019259',
'016696',
'020430',
'019916',
'018294',
'017753',
'018735',
'020351',
'016834',
'017642',
'020665',
'020453',
'016859',
'016428',
'020448',
'018900',
'020297',
'020451',
'020218',
'016481',
'020045',
'019252',
'018896',
'020548',
'020481',
'020643',
'018156',
'020065',
'018677',
'020371',
'018919',
'016962',
'020335',
'017154',
'019843',
'017506',
'017454',
'018809',
'019435',
'017474',
'019802',
'020560',
'018030',
'020366',
'018928',
'020405',
'020291',
'020262',
'016564',
'017150',
'019619',
'019591',
'020157',
'017916',
'020583',
'019231',
'019497',
'018318',
'020552',
'020565',
'018408',
'019507',
'020341',
'020636',
'016886',
'018724',
'020463',
'019634',
'018080',
'020260',
'020225',
'019925',
'006596',
'020617',
'018443',
'020384',
'020029',
'019429',
'020148',
'020163',
'019943',
'019991',
'019143',
'020571',
'020365',
'018945',
'020286',
'019760',
'020570',
'020655',
'020215',
'019792',
'020113',
'019956',
'020345',
'020349',
'017680',
'019575',
'020418',
'019692',
'018341',
'016713',
'019658',
'019941',
'020460',
'019830',
'019736',
'020536',
'019588',
'020031',
'018943',
'017182',
'018451',
'020273',
'020759',
'018720',
'019959',
'019226',
'017088',
'019976',
'020249',
'019799',
'016352',
'016936',
'018813',
'016709',
'019473',
'018833',
'016618',
'018220',
'020348',
'020094',
'017508',
'019483',
'020459',
'019807',
'017549',
'020685',
'020315',
'018244',
'019839',
'019750',
'016307',
'020634',
'018567',
'020023',
'017957',
'019420',
'018767',
'020216',
'020637',
'018125',
'018463',
'020275',
'020514',
'020426',
'019556',
'016511',
'019683',
'020039',
'016448',
'020235',
'019295',
'017135',
'016239',
'020296',
'017189',
'020264',
'020486',
'018173',
'020263',
'018541',
'020488',
'020005',
'019245',
'020425',
'020673',
'017800',
'016262',
'019526',
'017415',
'020309',
'018480',
'017547',
'019837',
'020200',
'020017',
'019580',
'019836',
'019212',
'020085',
'017986',
'018348',
'020289',
'019347',
'020416',
'019183',
'020677',
'020380',
'020483',
'019812',
'018589',
'017128',
'020354',
'017095',
'020269',
'020511',
'018580',
'019860',
'019505',
'019719',
'019842',
'016337',
'018003',
'020698',
'019654',
'020597',
'017776',
'018911',
'019363',
'020641',
'020355',
'016826',
'019121',
'020176',
'016310',
'020312',
'019774',
'019540',
'020088',
'020693',
'017258',
'020298',
'017423',
'020142',
'009005',
'020610',
'020038',
'020282',
'020720',
'020015',
'020589',
'020545',
'020638',
'020530',
'016858',
'019841',
'019494',
'020423',
'019676',
'020326',
'020333',
'019403')
and IsDisplay=1
group by Cmpid

select * from #clk
--该UC号2018年6月1日-2019年5月31日出过国内机票的常旅客人数
if OBJECT_ID('tempdb..#cs') is not null drop table #cs
select cmpcode,u.Name,pasname,idno,COUNT(1) 次数
into #cs
 from Topway..tbcash c with (nolock)
 left join homsomDB..Trv_UnitCompanies u on u.Cmpid=c.cmpcode
where inf=0
and datetime>='2018-06-01'
and datetime<'2019-06-01'
and cmpcode in('019892','020057','019708','019731','020110','018714','019640','020475','019656','020174','020470','020829','019833','020770','020702','017886','020191','020820','019023','019886','020776',
'020069','020704','020517','020445','020444','019854','016777','020645','020757','019393','019733','019592','019853','019901','018385''020737','019191','020214','020546','020535','017671','019794',
'018993','020207','019134','017909','017873','020162','013184','017623','020839','020533','020233','020472','020438','020825','019059','020169','020461','017458','020586','019436','019071','020675','019998','016911',
'017872','020190','018483','017202','020522','017939','020558','020754','020268','017850','020147','020199','018538','020859','020733','017146','018937','020567','019764','020715','019463',
'020290','020377','020745','019551','019834','020442','020395','018232','017667','020532','020598','019907','020775','020746','020271','020799','019623','020753','019520','020187','018938','020626',
'020143',
'020716',
'020790',
'020434',
'016676',
'020707',
'020559',
'019804',
'017542',
'020000',
'020771',
'019235',
'020243',
'016586',
'020703',
'017519',
'017893',
'020394',
'020835',
'019735',
'019097',
'020482',
'020728',
'017504',
'020731',
'020817',
'016559',
'020635',
'020719',
'020671',
'018017',
'020670',
'020793',
'020705',
'020732',
'002045',
'019423',
'020774',
'018758',
'019409',
'020154',
'019674',
'020555',
'017983',
'020283',
'019476',
'016883',
'018522',
'019609',
'020224',
'020741',
'019273',
'017931',
'019628',
'018539',
'018314',
'020253',
'019878',
'020228',
'020747',
'020592',
'018731',
'019701',
'020124',
'019670',
'019261',
'020447',
'020734',
'018940',
'019365',
'019461',
'016670',
'018343',
'019587',
'017822',
'019258',
'018676',
'017919',
'020538',
'017954',
'016492',
'019180',
'019348',
'020763',
'020786',
'018281',
'018719',
'020141',
'018412',
'020690',
'019442',
'017319',
'019462',
'019651',
'017687',
'017577',
'018790',
'020701',
'019110',
'019638',
'018546',
'017595',
'019568',
'018141',
'020547',
'017173',
'019227',
'020117',
'020128',
'018400',
'016724',
'017999',
'016284',
'018345',
'020401',
'017988',
'017300',
'020640',
'020036',
'015717',
'020708',
'018256',
'020219',
'020133',
'020709',
'018892',
'019721',
'018047',
'017932',
'007638',
'019584',
'020060',
'020195',
'020801',
'018930',
'016556',
'017654',
'019158',
'016339',
'020181',
'017559',
'018061',
'020496',
'019951',
'018726',
'019381',
'020729',
'020723',
'017007',
'020212',
'019717',
'019448',
'019978',
'020736',
'016719',
'020027',
'019021',
'020564',
'017955',
'019862',
'018827',
'020111',
'019897',
'016420',
'020591',
'020095',
'018418',
'020588',
'017016',
'019465',
'019919',
'019934',
'019970',
'018415',
'016490',
'017055',
'020114',
'018756',
'020468',
'020730',
'019757',
'019975',
'020189',
'020631',
'018669',
'020742',
'016348',
'016635',
'017924',
'020651',
'018902',
'019979',
'020327',
'018002',
'016504',
'020256',
'020711',
'019796',
'019863',
'020466',
'020579',
'018652',
'020202',
'018574',
'019859',
'017663',
'019205',
'020293',
'019817',
'020726',
'016379',
'019961',
'019771',
'019882',
'018690',
'020556',
'018367',
'017376',
'016264',
'017930',
'019089',
'019948',
'006944',
'019641',
'020294',
'020087',
'019349',
'020003',
'019506',
'019713',
'018362',
'020112',
'017065',
'017449',
'017921',
'016316',
'020304',
'020161',
'018834',
'020695',
'019072',
'019600',
'020787',
'020541',
'019712',
'019270',
'020317',
'018615',
'018671',
'020544',
'017273',
'020119',
'017682',
'017200',
'019230',
'020663',
'016617',
'019603',
'020165',
'020350',
'017740',
'019152',
'020456',
'019989',
'019284',
'018326',
'020561',
'020072',
'020467',
'016294',
'018134',
'016640',
'018536',
'018570',
'019784',
'020614',
'020575',
'018176',
'016497',
'016426',
'018926',
'016610',
'018103',
'019990',
'019844',
'020370',
'017661',
'020450',
'020364',
'019855',
'016751',
'018626',
'020115',
'016795',
'018037',
'019086',
'014412',
'017012',
'016689',
'020166',
'020717',
'020016',
'017956',
'019366',
'018766',
'016646',
'020553',
'020777',
'017020',
'020497',
'018108',
'020761',
'019629',
'020491',
'020656',
'018490',
'017327',
'016465',
'016477',
'019177',
'019772',
'016363',
'016289',
'017865',
'020061',
'020062',
'018395',
'018608',
'020630',
'019054',
'016354',
'020476',
'018560',
'018357',
'017495',
'020183',
'019450',
'020132',
'017033',
'017700',
'020138',
'020192',
'020084',
'018487',
'019997',
'020413',
'018939',
'016532',
'020053',
'020022',
'018822',
'017153',
'018202',
'020338',
'018634',
'019780',
'019939',
'017122',
'020699',
'019195',
'017193',
'020441',
'020694',
'016179',
'020287',
'020238',
'019455',
'019827',
'017493',
'016773',
'020231',
'016400',
'019219',
'019362',
'000126',
'020266',
'017399',
'016991',
'018773',
'020646',
'020507',
'020067',
'019958',
'020769',
'019259',
'016696',
'020430',
'019916',
'018294',
'017753',
'018735',
'020351',
'016834',
'017642',
'020665',
'020453',
'016859',
'016428',
'020448',
'018900',
'020297',
'020451',
'020218',
'016481',
'020045',
'019252',
'018896',
'020548',
'020481',
'020643',
'018156',
'020065',
'018677',
'020371',
'018919',
'016962',
'020335',
'017154',
'019843',
'017506',
'017454',
'018809',
'019435',
'017474',
'019802',
'020560',
'018030',
'020366',
'018928',
'020405',
'020291',
'020262',
'016564',
'017150',
'019619',
'019591',
'020157',
'017916',
'020583',
'019231',
'019497',
'018318',
'020552',
'020565',
'018408',
'019507',
'020341',
'020636',
'016886',
'018724',
'020463',
'019634',
'018080',
'020260',
'020225',
'019925',
'006596',
'020617',
'018443',
'020384',
'020029',
'019429',
'020148',
'020163',
'019943',
'019991',
'019143',
'020571',
'020365',
'018945',
'020286',
'019760',
'020570',
'020655',
'020215',
'019792',
'020113',
'019956',
'020345',
'020349',
'017680',
'019575',
'020418',
'019692',
'018341',
'016713',
'019658',
'019941',
'020460',
'019830',
'019736',
'020536',
'019588',
'020031',
'018943',
'017182',
'018451',
'020273',
'020759',
'018720',
'019959',
'019226',
'017088',
'019976',
'020249',
'019799',
'016352',
'016936',
'018813',
'016709',
'019473',
'018833',
'016618',
'018220',
'020348',
'020094',
'017508',
'019483',
'020459',
'019807',
'017549',
'020685',
'020315',
'018244',
'019839',
'019750',
'016307',
'020634',
'018567',
'020023',
'017957',
'019420',
'018767',
'020216',
'020637',
'018125',
'018463',
'020275',
'020514',
'020426',
'019556',
'016511',
'019683',
'020039',
'016448',
'020235',
'019295',
'017135',
'016239',
'020296',
'017189',
'020264',
'020486',
'018173',
'020263',
'018541',
'020488',
'020005',
'019245',
'020425',
'020673',
'017800',
'016262',
'019526',
'017415',
'020309',
'018480',
'017547',
'019837',
'020200',
'020017',
'019580',
'019836',
'019212',
'020085',
'017986',
'018348',
'020289',
'019347',
'020416',
'019183',
'020677',
'020380',
'020483',
'019812',
'018589',
'017128',
'020354',
'017095',
'020269',
'020511',
'018580',
'019860',
'019505',
'019719',
'019842',
'016337',
'018003',
'020698',
'019654',
'020597',
'017776',
'018911',
'019363',
'020641',
'020355',
'016826',
'019121',
'020176',
'016310',
'020312',
'019774',
'019540',
'020088',
'020693',
'017258',
'020298',
'017423',
'020142',
'009005',
'020610',
'020038',
'020282',
'020720',
'020015',
'020589',
'020545',
'020638',
'020530',
'016858',
'019841',
'019494',
'020423',
'019676',
'020326',
'020333',
'019403')
group by cmpcode,u.Name,pasname,idno

select * from #cs order by cmpcode

select c.cmpcode,Name,COUNT(1) 人数
from #cs c
inner join #clk cl on c.cmpcode=cl.UC号 and (pasname=中文姓名 or pasname=英文姓名)
group by  c.cmpcode,Name
order by c.cmpcode


select distinct pasname,idno from Topway..tbcash where cmpcode='002045'
and datetime>='2018-06-01'
and datetime<'2019-06-01'

--该UC号2017年6月1日-2019年5月31日出过国内机票的常旅客人数
if OBJECT_ID('tempdb..#cs') is not null drop table #cs
select cmpcode,u.Name,pasname,idno,COUNT(1) 次数
into #cs
 from Topway..tbcash c with (nolock)
 left join homsomDB..Trv_UnitCompanies u on u.Cmpid=c.cmpcode
where inf=0
and datetime>='2017-06-01'
and datetime<'2019-06-01'
and cmpcode in('019892','020057','019708','019731','020110','018714','019640','020475','019656','020174','020470','020829','019833','020770','020702','017886','020191','020820','019023','019886','020776',
'020069','020704','020517','020445','020444','019854','016777','020645','020757','019393','019733','019592','019853','019901','018385''020737','019191','020214','020546','020535','017671','019794',
'018993','020207','019134','017909','017873','020162','013184','017623','020839','020533','020233','020472','020438','020825','019059','020169','020461','017458','020586','019436','019071','020675','019998','016911',
'017872','020190','018483','017202','020522','017939','020558','020754','020268','017850','020147','020199','018538','020859','020733','017146','018937','020567','019764','020715','019463',
'020290','020377','020745','019551','019834','020442','020395','018232','017667','020532','020598','019907','020775','020746','020271','020799','019623','020753','019520','020187','018938','020626',
'020143',
'020716',
'020790',
'020434',
'016676',
'020707',
'020559',
'019804',
'017542',
'020000',
'020771',
'019235',
'020243',
'016586',
'020703',
'017519',
'017893',
'020394',
'020835',
'019735',
'019097',
'020482',
'020728',
'017504',
'020731',
'020817',
'016559',
'020635',
'020719',
'020671',
'018017',
'020670',
'020793',
'020705',
'020732',
'002045',
'019423',
'020774',
'018758',
'019409',
'020154',
'019674',
'020555',
'017983',
'020283',
'019476',
'016883',
'018522',
'019609',
'020224',
'020741',
'019273',
'017931',
'019628',
'018539',
'018314',
'020253',
'019878',
'020228',
'020747',
'020592',
'018731',
'019701',
'020124',
'019670',
'019261',
'020447',
'020734',
'018940',
'019365',
'019461',
'016670',
'018343',
'019587',
'017822',
'019258',
'018676',
'017919',
'020538',
'017954',
'016492',
'019180',
'019348',
'020763',
'020786',
'018281',
'018719',
'020141',
'018412',
'020690',
'019442',
'017319',
'019462',
'019651',
'017687',
'017577',
'018790',
'020701',
'019110',
'019638',
'018546',
'017595',
'019568',
'018141',
'020547',
'017173',
'019227',
'020117',
'020128',
'018400',
'016724',
'017999',
'016284',
'018345',
'020401',
'017988',
'017300',
'020640',
'020036',
'015717',
'020708',
'018256',
'020219',
'020133',
'020709',
'018892',
'019721',
'018047',
'017932',
'007638',
'019584',
'020060',
'020195',
'020801',
'018930',
'016556',
'017654',
'019158',
'016339',
'020181',
'017559',
'018061',
'020496',
'019951',
'018726',
'019381',
'020729',
'020723',
'017007',
'020212',
'019717',
'019448',
'019978',
'020736',
'016719',
'020027',
'019021',
'020564',
'017955',
'019862',
'018827',
'020111',
'019897',
'016420',
'020591',
'020095',
'018418',
'020588',
'017016',
'019465',
'019919',
'019934',
'019970',
'018415',
'016490',
'017055',
'020114',
'018756',
'020468',
'020730',
'019757',
'019975',
'020189',
'020631',
'018669',
'020742',
'016348',
'016635',
'017924',
'020651',
'018902',
'019979',
'020327',
'018002',
'016504',
'020256',
'020711',
'019796',
'019863',
'020466',
'020579',
'018652',
'020202',
'018574',
'019859',
'017663',
'019205',
'020293',
'019817',
'020726',
'016379',
'019961',
'019771',
'019882',
'018690',
'020556',
'018367',
'017376',
'016264',
'017930',
'019089',
'019948',
'006944',
'019641',
'020294',
'020087',
'019349',
'020003',
'019506',
'019713',
'018362',
'020112',
'017065',
'017449',
'017921',
'016316',
'020304',
'020161',
'018834',
'020695',
'019072',
'019600',
'020787',
'020541',
'019712',
'019270',
'020317',
'018615',
'018671',
'020544',
'017273',
'020119',
'017682',
'017200',
'019230',
'020663',
'016617',
'019603',
'020165',
'020350',
'017740',
'019152',
'020456',
'019989',
'019284',
'018326',
'020561',
'020072',
'020467',
'016294',
'018134',
'016640',
'018536',
'018570',
'019784',
'020614',
'020575',
'018176',
'016497',
'016426',
'018926',
'016610',
'018103',
'019990',
'019844',
'020370',
'017661',
'020450',
'020364',
'019855',
'016751',
'018626',
'020115',
'016795',
'018037',
'019086',
'014412',
'017012',
'016689',
'020166',
'020717',
'020016',
'017956',
'019366',
'018766',
'016646',
'020553',
'020777',
'017020',
'020497',
'018108',
'020761',
'019629',
'020491',
'020656',
'018490',
'017327',
'016465',
'016477',
'019177',
'019772',
'016363',
'016289',
'017865',
'020061',
'020062',
'018395',
'018608',
'020630',
'019054',
'016354',
'020476',
'018560',
'018357',
'017495',
'020183',
'019450',
'020132',
'017033',
'017700',
'020138',
'020192',
'020084',
'018487',
'019997',
'020413',
'018939',
'016532',
'020053',
'020022',
'018822',
'017153',
'018202',
'020338',
'018634',
'019780',
'019939',
'017122',
'020699',
'019195',
'017193',
'020441',
'020694',
'016179',
'020287',
'020238',
'019455',
'019827',
'017493',
'016773',
'020231',
'016400',
'019219',
'019362',
'000126',
'020266',
'017399',
'016991',
'018773',
'020646',
'020507',
'020067',
'019958',
'020769',
'019259',
'016696',
'020430',
'019916',
'018294',
'017753',
'018735',
'020351',
'016834',
'017642',
'020665',
'020453',
'016859',
'016428',
'020448',
'018900',
'020297',
'020451',
'020218',
'016481',
'020045',
'019252',
'018896',
'020548',
'020481',
'020643',
'018156',
'020065',
'018677',
'020371',
'018919',
'016962',
'020335',
'017154',
'019843',
'017506',
'017454',
'018809',
'019435',
'017474',
'019802',
'020560',
'018030',
'020366',
'018928',
'020405',
'020291',
'020262',
'016564',
'017150',
'019619',
'019591',
'020157',
'017916',
'020583',
'019231',
'019497',
'018318',
'020552',
'020565',
'018408',
'019507',
'020341',
'020636',
'016886',
'018724',
'020463',
'019634',
'018080',
'020260',
'020225',
'019925',
'006596',
'020617',
'018443',
'020384',
'020029',
'019429',
'020148',
'020163',
'019943',
'019991',
'019143',
'020571',
'020365',
'018945',
'020286',
'019760',
'020570',
'020655',
'020215',
'019792',
'020113',
'019956',
'020345',
'020349',
'017680',
'019575',
'020418',
'019692',
'018341',
'016713',
'019658',
'019941',
'020460',
'019830',
'019736',
'020536',
'019588',
'020031',
'018943',
'017182',
'018451',
'020273',
'020759',
'018720',
'019959',
'019226',
'017088',
'019976',
'020249',
'019799',
'016352',
'016936',
'018813',
'016709',
'019473',
'018833',
'016618',
'018220',
'020348',
'020094',
'017508',
'019483',
'020459',
'019807',
'017549',
'020685',
'020315',
'018244',
'019839',
'019750',
'016307',
'020634',
'018567',
'020023',
'017957',
'019420',
'018767',
'020216',
'020637',
'018125',
'018463',
'020275',
'020514',
'020426',
'019556',
'016511',
'019683',
'020039',
'016448',
'020235',
'019295',
'017135',
'016239',
'020296',
'017189',
'020264',
'020486',
'018173',
'020263',
'018541',
'020488',
'020005',
'019245',
'020425',
'020673',
'017800',
'016262',
'019526',
'017415',
'020309',
'018480',
'017547',
'019837',
'020200',
'020017',
'019580',
'019836',
'019212',
'020085',
'017986',
'018348',
'020289',
'019347',
'020416',
'019183',
'020677',
'020380',
'020483',
'019812',
'018589',
'017128',
'020354',
'017095',
'020269',
'020511',
'018580',
'019860',
'019505',
'019719',
'019842',
'016337',
'018003',
'020698',
'019654',
'020597',
'017776',
'018911',
'019363',
'020641',
'020355',
'016826',
'019121',
'020176',
'016310',
'020312',
'019774',
'019540',
'020088',
'020693',
'017258',
'020298',
'017423',
'020142',
'009005',
'020610',
'020038',
'020282',
'020720',
'020015',
'020589',
'020545',
'020638',
'020530',
'016858',
'019841',
'019494',
'020423',
'019676',
'020326',
'020333',
'019403')
group by cmpcode,u.Name,pasname,idno

--该司MU和FM的国内S V T Z舱出票销量站国内总销量占比
if OBJECT_ID('tempdb..#xl1') is not null drop table #xl1
select cmpcode UC号,Name 公司名称,SUM(totprice) 国内销量
into #xl1
from Topway..tbcash c
left join homsomDB..Trv_UnitCompanies un on un.Cmpid=c.cmpcode
where CertificateD=2
and inf=0
and nclass in('S','v','t','z')
and ride in('FM','mu')
and datetime>='2018-07-01'
and datetime<'2019-06-10'
--and tickettype='电子票'
group by cmpcode,Name
order by 国内销量

if OBJECT_ID('tempdb..#xl2') is not null drop table #xl2
select cmpcode UC号,Name 公司名称,SUM(totprice) 国内销量
into #xl2
from Topway..tbcash c
left join homsomDB..Trv_UnitCompanies un on un.Cmpid=c.cmpcode
where CertificateD=2
and inf=0
--and nclass in('S','v','t','z')
and ride in('FM','mu')
and datetime>='2018-07-01'
and datetime<'2019-06-10'
--and tickettype='电子票'
group by cmpcode,Name
order by 国内销量

--select * from #xl2 where UC号='020829'
--select * from #xl1 where UC号='020829'

select x1.UC号,x1.公司名称,x1.国内销量/x2.国内销量 销量占比  from #xl1 x1 
left join #xl2 x2 on x1.UC号=x2.UC号

--重开打印权限
select Pstatus,PrDate,* from Topway..tbTrvKhSk 
--update Topway..tbTrvKhSk  set Pstatus=0,PrDate='1900-01-01'
where TrvId='29877' and Id='227603'

--机票业务顾问信息
select sales,SpareTC,* from Topway..tbcash 
--update Topway..tbcash  set sales='黄怡丽',SpareTC='黄怡丽'
where coupno='AS001698933'

/*

     出票日期：      2019年3月1日至5月31日
     退票审核日期： 2019年3月1日至5月31日
     申请费来源：   申请座位ZYI  / 申请座位HYI
     
     报表要求：   出票/退票审核日期，申请费金额 ， 分2个SHEET
*/
select tcode+ticketno 票号,datetime 出票日期,feiyong 申请费金额,feiyonginfo 申请费来源 from Topway..tbcash 
where datetime>='2019-03-01'
and datetime<'2019-06-01'
and feiyonginfo in('申请座位ZYI','申请座位HYI')

select  c.tcode+c.ticketno 票号,ExamineDate 退票审核日期,c.feiyong-t.sfeiyong HS申请费应收金额 ,c.feiyonginfo 申请费来源
from Topway..tbReti t
left join Topway..tbcash c on c.reti=t.reno
where feiyonginfo in('申请座位ZYI','申请座位HYI')
and ExamineDate>='2019-03-01'
and ExamineDate<'2019-06-01'
order by 退票审核日期


--旅游预算单信息
select Cmpid,Custinfo,CustomerType,* from Topway..tbTravelBudget 
--update Topway..tbTravelBudget  set Cmpid='',Custinfo='13801836921@WANG/CHUTSEN@UC016465@@WANG/CHUTSEN@13801836921@D635924',CustomerType='个人客户'
where TrvId='29633'

--账单撤销
select SubmitState,* from Topway..AccountStatement 
--update Topway..AccountStatement  set SubmitState=1
where BillNumber='020459_20190501'