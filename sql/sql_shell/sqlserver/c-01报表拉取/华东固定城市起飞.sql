IF OBJECT_ID('tempdb.dbo.#emp') IS NOT NULL DROP TABLE #emp
SELECT ROW_NUMBER()OVER(ORDER BY t2.depOrder,t1.idnumber) idx,empname,team 
INTO #emp 
from emppwd t1 LEFT JOIN dbo.EmpSysSetting t2 ON t1.team=t2.dep AND t2.ntype=2 where t1.dep = '运营部' and team like ('%差旅%') order by t2.depOrder,t1.idnumber 

IF OBJECT_ID('tempdb.dbo.#t1') IS NOT NULL DROP TABLE #t1
select emp.team,sales,COUNT(*) *0.5 as 张数
into #t1
from tbcash c
left join #emp emp on Emp.empname=c.sales
where datetime>='2018-09-21' and datetime<'2018-09-29'
and begdate>='2018-09-21' and begdate<'2018-09-29'
and ride in ('CZ') and tcode='784'
and reti=''
and inf=0
and (SUBSTRING(route,1,CHARINDEX('-',route)-1) in (select Name from homsomDB..Trv_Cities where CountryType=1
and Code in ('NKG','SHA','PVG','WUX','WNZ','JUH','TXN','FUG','QAG','HFE','KHN','JGS','KOW','HSN','NGB','LYG','XUZ','YNZ','YTY','YZO','CZX','NTG','HGH'))
or (SUBSTRING(route,1,CHARINDEX('-',route)-1) in ('南京','上海','上海虹桥','上海浦东','无锡','温州','九华山','黄山','阜阳','安庆','合肥','南昌','井冈山','赣州','舟山','宁波','连云港','徐州',
'盐城','扬州','常州','南通','杭州')))
group by sales,emp.team
order by team

IF OBJECT_ID('tempdb.dbo.#t2') IS NOT NULL DROP TABLE #t2
select emp.team,SpareTC,COUNT(*) *0.5 as 张数
into #t2
from tbcash c
left join #emp emp on Emp.empname=c.SpareTC
where datetime>='2018-09-21' and datetime<'2018-09-29'
and begdate>='2018-09-21' and begdate<'2018-09-29'
and ride in ('CZ') and tcode='784'
and reti=''
and inf=0
and (SUBSTRING(route,1,CHARINDEX('-',route)-1) in (select Name from homsomDB..Trv_Cities where CountryType=1
and Code in ('NKG','SHA','PVG','WUX','WNZ','JUH','TXN','FUG','QAG','HFE','KHN','JGS','KOW','HSN','NGB','LYG','XUZ','YNZ','YTY','YZO','CZX','NTG','HGH'))
or (SUBSTRING(route,1,CHARINDEX('-',route)-1) in ('南京','上海','上海虹桥','上海浦东','无锡','温州','九华山','黄山','阜阳','安庆','合肥','南昌','井冈山','赣州','舟山','宁波','连云港','徐州',
'盐城','扬州','常州','南通','杭州')))
group by SpareTC,emp.team
order by team


IF OBJECT_ID('tempdb.dbo.#t3') IS NOT NULL DROP TABLE #t3
select emp.team,empname,isnull(t1.张数,0)+isnull(t2.张数,0) as 张数
into #t3
from #emp emp
left join #t1 t1 on Emp.empname=t1.sales
left join #t2 t2 on Emp.empname=t2.SpareTC

select * from #t3 
--where 张数<>0



--SELECT 
--h.GroupName,c.sales,COUNT(*) 
----SUBSTRING(route,1,CHARINDEX('-',route)-1),*
--FROM tbcash c 
--LEFT JOIN dbo.Emppwd e ON c.sales=e.empname
--LEFT JOIN dbo.HM_TCGroupInfo h ON e.groupid=h.Pkey
--WHERE 
--datetime BETWEEN '2018-09-21' AND '2018-09-26' AND begdate BETWEEN '2018-09-21' AND '2018-09-29'
--AND inf IN(0) AND tcode='784' AND c.reti=''
--AND SUBSTRING(route,1,CHARINDEX('-',route)-1) IN(
--'NKG','SHA','PVG','WUX','WNZ','JUH','TXN','FUG','QAG','HFE','KHN','JGS','KOW','HSN','NGB','LYG','XUZ','YNZ','YTY','YZO','CZX','NTG','HGH',
--'南京','上海','上海虹桥','上海浦东','无锡','温州','九华山','黄山','阜阳','安庆','合肥','南昌','井冈山','赣州','舟山','宁波','连云港','徐州',
--'盐城','扬州','常州','南通','杭州'
--)
--GROUP BY h.GroupName,c.sales
--ORDER BY h.GroupName DESC

--select reti,* from tbcash where sales='周琦'
--and datetime>='2018-09-21' and datetime<'2018-09-27'
--and begdate>='2018-09-21' and begdate<'2018-09-30'
--and inf=0
-- and ride='CZ'
-- and tcode='784'
-- and reti=''
-- AND SUBSTRING(route,1,CHARINDEX('-',route)-1) IN(
--'NKG','SHA','PVG','WUX','WNZ','JUH','TXN','FUG','QAG','HFE','KHN','JGS','KOW','HSN','NGB','LYG','XUZ','YNZ','YTY','YZO','CZX','NTG','HGH',
--'南京','上海','上海虹桥','上海浦东','无锡','温州','九华山','黄山','阜阳','安庆','合肥','南昌','井冈山','赣州','舟山','宁波','连云港','徐州',
--'盐城','扬州','常州','南通','杭州'
--)

--order by coupno

--select reti,* from tbcash where coupno in ('AS001929509')


select datetime,* from tbcash c where datetime between '2018-09-21' and '2018-09-23' order by c.datetime desc
select begdate,* from tbcash c where begdate between '2018-09-21' and '2018-09-23' order by c.begdate desc




select datetime,begdate,tcode+ticketno,route
from tbcash c
where datetime>='2018-09-01' and datetime<'2018-09-29'
and begdate>='2018-09-01' and begdate<'2018-09-29'
and ride in ('CZ') and tcode='784'
and reti=''
and inf=0
and (SUBSTRING(route,1,CHARINDEX('-',route)-1) in (select Name from homsomDB..Trv_Cities where CountryType=1
and Code in ('NKG','SHA','PVG','WUX','WNZ','JUH','TXN','FUG','QAG','HFE','KHN','JGS','KOW','HSN','NGB','LYG','XUZ','YNZ','YTY','YZO','CZX','NTG','HGH'))
or (SUBSTRING(route,1,CHARINDEX('-',route)-1) in ('南京','上海','上海虹桥','上海浦东','无锡','温州','九华山','黄山','阜阳','安庆','合肥','南昌','井冈山','赣州','舟山','宁波','连云港','徐州',
'盐城','扬州','常州','南通','杭州')))
and tcode+ticketno not in 
('7842894912230','7842894912331','7842894912181','7842894912370','7842894912543','7842894912173','7842894912247','7842894912177','7842894912855','7842894912640','7842894912904','7842894912561','7842894912725','7842894913423','7842894912461','7842894912562','7842895341330','7842894912365','7842894912505','7842894912199','7842894912551','7842894912690','7842894912462','7842894912504','7842894912176','7842894912591','7842894913987','7842894913918','7842894912748','7842894912884','7842894912821','7842894913768','7842895341501','7842894913989','7842894913064','7842894913969','7842895341482','7842894912852','7842894913499','7842894913968','7842894912772','7842895341512','7842894913967','7842895341631','7842894913134','7842894912310','7842894913582','7842895459813','7842894913102','7842894913158','7842894913144','7842894913647','7842895341569','7842894913454','7842894913709','7842894913245','7842894913427','7842894913501','7842894913688','7842894913723','7842894913640','7842894913708','7842894913936','7842894913441','7842894913404','7842894913819','7842895669782','7842894912776','7842895669652','7842894913310','7842894913115','7842894912979','7842895341538','7842895460380','7842895341267','7842895341574','7842894913992','7842894912705','7842894913405','7842894912311','7842895341529','7842895459893','7842894913954','7842895341526','7842895341535','7842894913953','7842894913916','7842894913233','7842895342137','7842894913390','7842895670502','7842894913632','7842894912636','7842894913234','7842366630599','7842895459875','7842895669839','7842894913631','7842895669618','7842894913980','7842895341809','7842894913167','7842894913985','7842894913965','7842895342176','7842894912817','7842895669835','7842895341999','7842894913981','7842895459842','7842894913964','7842895670031','7842895669803','7842894912777','7842895670560','7842895669845','7842895460149','7842895459923','7842895342154','7842895670997','7842895459922','7842894912826','7842895669591','7842895669939','7842895669807','7842895459921','7842895669836','7842894913889','7842895342165','7842895460264','7842895460150','7842895341495','7842895669804','7842895341794','7842895341819','7842895670996','7842895341793','7842895670109','7842896295263','7842894913901','7842894913900','7842896295709','7842895460199','7842895671309','7842895670306','7842895670282','7842895342074','7842895342015','7842895460181','7842895669654','7842894913555','7842895459912','7842895670441','7842895670115','7842895670112','7842895341849','7842894913707','7842895670553','7842895671457','7842895342253','7842895671027','7842895669769','7842895669670','7842895669983','7842895670267','7842895669655','7842895671557','7842895669936','7842895670822','7842895342252','7842895460382','7842895341605','7842895671167','7842895670956','7842895670213','7842895670233','7842895671301','7842895671310','7842896295728','7842894913702','7842896296571','7842895671412','7842895671363','7842895671374','7842896295479','7842896295939','7842895670616','7842896295988','7842895671301','7842896296461','7842894912175','7842896296022','7842896296460','7842894912174','7842895341800','7842895671362','7842895671085','7842895670965','7842895671380','7842895670542','7842895669667','7842894912757','7842895670443','7842896721465','7842896296670','7842896721770','7842896721768','7842895341919','7842895669987','7842895670905','7842895669745','7842896721129','7842894913792','7842896721573','7842896296325','7842894913906','7842895670034','7842895670045','7842896295850','7842896295998','7842895341932','7842896721218','7842896721217','7842895670636','7842896721878','7842895669674','7842896721944','7842896296160','7842896722034','7842895669589','7842896721674','7842896295938','7842896296409','7842367053347','7842896721987','7842896296429','7842896295999','7842896721208','7842896296408','7842896296659','7842896721689','7842895669662','7842896721553','7842894913755','7842895670438','7842896295469','7842895670118','7842896722239','7842894913529','7842894913528','7842896722104','7842895670119','7842896295324','7842896296201','7842896296872','7842896295278','7842896722417','7842896721635','7842894913389','7842896721787','7842896295885','7842896721636','7842896296807','7842896295313','7842896722115','7842896722013','7842895460345','7842895671246','7842896296043','7842896721711','7842895669736','7842895460164','7842896296401','7842896295886','7842895460167','7842896722913','7842896295743','7842896296386','7842896721714','7842896722010','7842896721643','7842896721999','7842896722012','7842895671247','7842896722027','7842895460346','7842896721751','7842896722016','7842896722017','7842896721745','7842896295742','7842896721629','7842896296590','7842896295516','7842896295450','7842896296681','7842895341468','7842896721270','7842897339211','7842896296841','7842897338967','7842897339059','7842896722048','7842897438859','7842895459936','7842897438514','7842896296842','7842897439371','7842897338969','7842896722255','7842897339111','7842897439251','7842896296621','7842896721632','7842896296840','7842895671180','7842896296620','7842897438785','7842897339060','7842897438912','7842897438906','7842896296615','7842896722121','7842897438907','7842897339036','7842895671177','7842897339141','7842895670783','7842897339212','7842896722683','7842897439250','7842897339098','7842897438878','7842896722396','7842897439162','7842895670283','7842897339187','7842895671272','7842892796796','7842897339097','7842896296704','7842896721802','7842896722122','7842896722195','7842896722807','7842896722829','7842896721602','7842896296619','7842896721804','7842896722079','7842896721803','7842895459935','7842897338968','7842895460336','7842896721801','7842896722466','7842896722296','7842896295567','7842896295557','7842897439493','7842897338855','7842897439210','7842892707076','7842897438872','7842895342198','7842895460250','7842897439360','7842897439025','7842897438957','7842896722920','7842896296536','7842897439026','7842896722181','7842895341808','7842897339018','7842897339017','7842894912975','7842897886212','7842896721255','7842897438654','7842897438978','7842897438885','7842896721318','7842897438884','7842896296968','7842897439342','7842897885131','7842897885828','7842896722862','7842896722614','7842897339033','7842896722863','7842897439087','7842896722167','7842897885072','7842897885978','7842897884927','7842897439341','7842897885109','7842897438991','7842897885041','7842897885433','7842897438542','7842897886086','7842897439465','7842896722166','7842892794632','7842897885797','7842895670817','7842897885241','7842894913908','7842897438560','7842896722052','7842896721273','7842896722147','7842897886598','7842897886531','7842897885724','7842897885314','7842898313099','7842898313581','7842897885313','7842897885688','7842898313314','7842897885853','7842896296858','7842896296746','7842898313072','7842897885723','7842897885488','7842897439419','7842894912928','7842897439261','7842898313100','7842894912921','7842897885223','7842897439418','7842897886646','7842897885387','7842897439300','7842898313006','7842897886661','7842896296814','7842896296468','7842897885865','7842898313069','7842898313292','7842897886660','7842897885825','7842898313084','7842898314209','7842898313836','7842897885687','7842896722692','7842897885279','7842897886765','7842897886582','7842897886495','7842897885140','7842896295638','7842898313532','7842897885864','7842894913907','7842897886715','7842898313085','7842892802396','7842892802397','7842897886351','7842897886114','7842898314431','7842897884941','7842897886642','7842897886539','7842898314428','7842897885363','7842898313330','7842894912974','7842898313612','7842898313509','7842897886547','7842898313581','7842898314621','7842898314429','7842898314433','7842898314654','7842897886055','7842897885364','7842898314430','7842897886410','7842897439052','7842896296134','7842898314065','7842898635208','7842896295452','7842897886411','7842897886146','7842897886132','7842898635238','7842896295456','7842898313650','7842898314453','7842897884967','7842898313775','7842894913689','7842897885863','7842898635466','7842897885601','7842898635467','7842896296914','7842898636117','7842897884981','7842898635605','7842898313355','7842897885746','7842898314889','7842897439273','7842898635079','7842898314634','7842898636113','7842898313514','7842895669653','7842898636462','7842898314384','7842897885782','7842898313578','7842895670950','7842896295319','7842897438862','7842898636239','7842897438861','7842898635977','7842898635442','7842896722299','7842897885408','7842898636356','7842897439423','7842897439283','7842898635354','7842897885059','7842896722866','7842898314647','7842897885102','7842896295329','7842898313299','7842896295330','7842898313546','7842898636630','7842898635253','7842898314685','7842897885948','7842898635928','7842893931065','7842898636670','7842899201094','7842898636707','7842893914013','7842898636864','7842898636928','7842898314314','7842897886207','7842899201077','7842899201496','7842893931066','7842897339025','7842897339027','7842895460128','7842898314838','7842898636294','7842898636793','7842899201302','7842898636497','7842894912818','7842898636105','7842899201125','7842897339026','7842898313529','7842897439466','7842898636991','7842896722262','7842898636632','7842899201945','7842897885785','7842898636794','7842898314683','7842898635943','7842894912186','7842898313630','7842895669953','7842897885757','7842898636295','7842898635723','7842897885112','7842897886760','7842898636552','7842897885756','7842898313445','7842899201142','7842898314684','7842898635949','7842898636489','7842893946818','7842898636514','7842898314682','7842898636741','7842899201722','7842898636529','7842898635540','7842897439089','7842898636584','7842896295790','7842898636074','7842898313241','7842897886315','7842897885553','7842899730287','7842894913915','7842898635492','7842898314893','7842899730381','7842897886441','7842899201922','7842897886467','7842899730960','7842895671420','7842895341405','7842898636660','7842898313493','7842898636689','7842899730550','7842899201879','7842899201501','7842935313307','7842899730771','7842899201143','7842899201186','7842897886216','7842897885370','7842899730286','7842898636588','7842897439338','7842899201517','7842899201041','7842897885371','7842899730339','7842899201852','7842899201391','7842898636879','7842930052772','7842898636646','7842899201092','7842898636658','7842899730526','7842899201322','7842898636763','7842898635711','7842898636764','7842898636878','7842896722282','7842899731211','7842897439358','7842895341404','7842897886308','7842899731226','7842897439359','7842899730244','7842898636657','7842895341700','7842898635712','7842899731227','7842899730412','7842897885220','7842897886459','7842895669754','7842893917785','7842894912764','7842899200968','7842897885579','7842895669755','7842899201268','7842897886390','7842899731216','7842898313954','7842898313955','7842898313953','7842897885102','7842899730902','7842896722477','7842899731129','7842899731324','7842899201928','7842892805893','7842895460203','7842893982276','7842899730772','7842899730259','7842935313598','7842898636761','7842935313848','7842935313681','7842935313455','7842935313674','7842899730671','7842898635315','7842935313037','7842892805894','7842935313377','7842898635267','7842899201340','7842896296818','7842899201189','7842899201864','7842935313675','7842897439356','7842899201093','7842898635268','7842898636868','7842935313368','7842897886118','7842899731042','7842898313016','7842899201783','7842935313728','7842899730750','7842899731041','7842899201312','7842899201638','7842899730777','7842899201865','7842899730260','7842899730947','7842896722996','7842899731131','7842899201339','7842892803887','7842935314494','7842896722984','7842899201470','7842899730262','7842935313753','7842899730599','7842935313369','7842899201338','7842899730261','7842899730493','7842935313365','7842899730536','7842899730598','7842899201607','7842898636021','7842899731167','7842899731166','7842899730968','7842899730782','7842899200972','7842897885184','7842896296849','7842892805425','7842892805426','7842899731276','7842896295346','7842897885572','7842935313911','7842935513719','7842935313912','7842899730313','7842897886484','7842899201569','7842935314472','7842935313936','7842935313509','7842895670684','7842935313236','7842935314789','7842935314286','7842935314661','7842935314480','7842899730398','7842898636950','7842898314652','7842935512963','7842935313927','7842896296853','7842935513594','7842895460119','7842899730567','7842899201227','7842897886006','7842897886005','7842899201570','7842896296706','7842897886007','7842897885773','7842935512962','7842899730727','7842898635455','7842898314754','7842899730566','7842895460120','7842899730331','7842897438556','7842897339010','7842899201457','7842895671322','7842896295678','7842898636901','7842898636902','7842897438682','7842935313375','7842899730295','7842935513844','7842898313593','7842935313191','7842935513843','7842935314865','7842935513708','7842935313443','7842935513028','7842935513092','7842935513494','7842935313442','7842898313730','7842899730535','7842935513480','7842899731132','7842898636975','7842893535064','7842935513779','7842935513770','7842897884997','7842935313672','7842935773237','7842898313594','7842899201904','7842935513839','7842899201306','7842935313125','7842935312979','7842898314026','7842897884961','7842899201649','7842899201675','7842935513904','7842935313376','7842935313815','7842894913476','7842897886451','7842899201486','7842935314171','7842899201403','7842898314807','7842935314752','7842935513841','7842896722612','7842935313207','7842935513840','7842930081688','7842893983849','7842894913378','7842896721266','7842935512925','7842935773964','7842935513607','7842935513077','7842896295309','7842935773883','7842935314116','7842935773956','7842899201233','7842899201234','7842935512924','7842935513813','7842898314172','7842895670088','7842896721215','7842899201528','7842899201529','7842935774041','7842899730256','7842899201531','7842935774137','7842935313956','7842899201530','7842935513528','7842935774138','7842935313378','7842898314237','7842897884997','7842930024807','7842897885177','7842899201502','7842935773723','7842897884961','7842935774168','7842899731069','7842899201565','7842935513038','7842935513175','7842898314561','7842935774169','7842935773905','7842898635963','7842898314595','7842935313949','7842935314345','7842935512995','7842935773752','7842935774351','7842935774338','7842898636979','7842935513561','7842935313847','7842898635814','7842898635816','7842935774352','7842935513539','7842936686932','7842935772820','7842935513505','7842899201618','7842935773666','7842935514348','7842935514064','7842935773017','7842898635815','7842935513971','7842935773319','7842935772926','7842898313285','7842935514178','7842899730474','7842896296381','7842935774301','7842894912912','7842935773079','7842935514176','7842896722533','7842935314035','7842935774467','7842935774123','7842935513045','7842935774376','7842935313413','7842935774264','7842935514376','7842898635738','7842935514204','7842935513376','7842935774122','7842935774099','7842935514152','7842935314889','7842935773859','7842936686880','7842935513414','7842935514177','7842894912913','7842899731090','7842935514320','7842894912914','7842898635453','7842936687058','7842898635452','7842935513395','7842935774154','7842935514151','7842935514153','7842935773320','7842895341831','7842936686903','7842935513560','7842935513421','7842935513056','7842935774320','7842935514319','7842935774239','7842935774146','7842935513412','7842899731044','7842899730621','7842935513223','7842935773094','7842935514203','7842935513833','7842935513308','7842935512976','7842935774290','7842935772766','7842935774356','7842935513007','7842935773439','7842935513611','7842899731089','7842935774155','7842935514397','7842935513335','7842935773996','7842935773866','7842898636560','7842935313413','7842898636557','7842898636556','7842935774316','7842935774315','7842935774314','7842938034972','7842936686331','7842935513189','7842936687530','7842936687234','7842935513029','7842935314559','7842936687352','7842896722648','7842936687279','7842896722649','7842936686123','7842936687382','7842935314105','7842899201836','7842936686832','7842936687301','7842935773458','7842935774321','7842936686111','7842936687266','7842935773421','7842936687397','7842936686110','7842938034977','7842936686888','7842935774424','7842935773856','7842936686296','7842935313586','7842936686317','7842936687348','7842936686541','7842935514332','7842896722650','7842936686351','7842935513173','7842936686831','7842936687335','7842896722653','7842936686715','7842936687265','7842896722654','7842935514129','7842936686428','7842936687755','7842935513172','7842899731035','7842898636342','7842935773631','7842936687108','7842936687326','7842896722651','7842936686922','7842935313306','7842936686558','7842899731033','7842936686661','7842936687038','7842935773635','7842896722652','7842935773182','7842935774339','7842936686731','7842936687314','7842899731034','7842896722655','7842935313312','7842935313302','7842898313197','7842935774526','7842898313931','7842936974052','7842936687449','7842935314545','7842936687987','7842935773992','7842936974011','7842936687820','7842936687221','7842938035898','7842936686836','7842936687988','7842899201379','7842935313445','7842897886015','7842936687595','7842935313459','7842936686278','7842936686959','7842936687482','7842896721290','7842936686177','7842938035368','7842898635484','7842936686822','7842938035904','7842935773077','7842938035302','7842938035025','7842938034920','7842938034917','7842936687978','7842938035024','7842938035301','7842935772789','7842935313461','7842936687977','7842936687481','7842936686609','7842936973835','7842936687979','7842936686977','7842936686231','7842938035846','7842936686721','7842936687806','7842935313636','7842936686722','7842938035718','7842935313637','7842938036469','7842936687834','7842938036726','7842938035481','7842938036433','7842938036571','7842936973853','7842938035611','7842938035522','7842938036164','7842938036534','7842938035503','7842938036570','7842938036494','7842935774096','7842936687814','7842938035612','7842899730487','7842936687001','7842938036463','7842936687594','7842936687452','7842935772768','7842935773615','7842936686611','7842938036305','7842938036689','7842938036356','7842935314258','7842938035412','7842938036533','7842935513320','7842935314185','7842938035543','7842935773409')


select datetime,begdate,route,inf,reti,ride,tcode+ticketno from tbcash where coupno in ('AS001922265','AS001922121','AS001922265','AS001924709','AS001927692','AS001924136','AS001925318','AS001927692','AS001929791','AS001930881')

select datetime,begdate,route,inf,reti,ride,tcode+ticketno from tbcash where tcode+ticketno in ('7842935773996','7842935773866','7842935774314','7842936974052','7842936686977')


187 182