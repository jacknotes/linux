<VERSION>4.1.0</VERSION>
<SQLQUERY>
<REMARK>
[标题]
[应用背景] ：该报表由谁提出，要解决什么问题，用途
检查某天的销售流水是否正常，考虑到buy表数据量比较大，只允许查一天的数据

[结果列描述] ：

[必要的查询条件] ：

[实现方法] ：简要描述报表的数据源、构造算法，以及关键列的算法
SELECT
POSNO,FLOWNO,CASHIER,FILDATE,STDTOTAL,
SCRTOTAL,REALAMT,CARDNO,RECCNT,MEMO,
SCRFAVMODE,SCRFAVVALUE,DEALER,SCORE,RCVTIME,
CLASSDATE,CLASSNO,BUSDATE,CONTINUOUSFLOWNO
from buy1s
where (to_date(substr(flowno,1,8),'yyyy.mm.dd')=VDATE 
or trunc(fildate)=VDATE)
and trunc(fildate)<>to_date(substr(flowno,1,8),'yyyy.mm.dd')

[临时表结构]：如果有用到临时表，需要附加临时表的创建sql
CREATE GLOBAL TEMPORARY TABLE H4RTMP_BUY1SCHECK
(
  POSNO            VARCHAR2(10) not null,
  FLOWNO           VARCHAR2(12) not null,
  CASHIER          INTEGER,
  FILDATE          DATE,
  STDTOTAL         NUMBER(24,2),
  SCRTOTAL         NUMBER(24,2),
  REALAMT          NUMBER(24,2),
  CARDNO           VARCHAR2(20),
  RECCNT           INTEGER,
  MEMO             VARCHAR2(255),
  SCRFAVMODE       INTEGER,
  SCRFAVVALUE      NUMBER(24,2),
  DEALER           INTEGER,
  SCORE            NUMBER(24,2) default 0 not null,
  RCVTIME          DATE,
  CLASSDATE        DATE,
  CLASSNO          INTEGER,
  BUSDATE          DATE,
  CONTINUOUSFLOWNO VARCHAR2(18),
  CHECKDATE        DATE   --在检查时输入的日期条件
)
ON COMMIT PRESERVE ROWS;
EXEC hdcreatesynonym('H4RTMP_BUY1SCHECK','HD40');
EXEC granttoqryrole('H4RTMP_BUY1SCHECK');

[版本记录]： 时间+创建人/修改人，后续修改在原有基础上追加
2010年10月04日 10:39 创建人：邹勇

[其它]：可选
</REMARK>
<BEFORERUN>
-- Created on 2010-10-4 by ZOUYONG
/*
CREATE GLOBAL TEMPORARY TABLE H4RTMP_BUY1SCHECK
(
  POSNO            VARCHAR2(10) not null,
  FLOWNO           VARCHAR2(12) not null,
  CASHIER          INTEGER,
  FILDATE          DATE,
  STDTOTAL         NUMBER(24,2),
  SCRTOTAL         NUMBER(24,2),
  REALAMT          NUMBER(24,2),
  CARDNO           VARCHAR2(20),
  RECCNT           INTEGER,
  MEMO             VARCHAR2(255),
  SCRFAVMODE       INTEGER,
  SCRFAVVALUE      NUMBER(24,2),
  DEALER           INTEGER,
  SCORE            NUMBER(24,2) default 0 not null,
  RCVTIME          DATE,
  CLASSDATE        DATE,
  CLASSNO          INTEGER,
  BUSDATE          DATE,
  CONTINUOUSFLOWNO VARCHAR2(18),
  CHECKBEGINDATE   DATE,     ----在检查时输入开始日期条件
  CHECKENDDATE     DATE----在检查时输入结束日期条件
)
ON COMMIT PRESERVE ROWS;
EXEC hdcreatesynonym('H4RTMP_BUY1SCHECK','HD40');
EXEC granttoqryrole('H4RTMP_BUY1SCHECK');
*/

DECLARE
VBEGINDATE DATE;  --需要检查的开始日期
VENDDATE   DATE;  --需要检查的结束日期

BEGIN
--先清理残留数据
DELETE H4RTMP_BUY1SCHECK;
--一定要提交事务
COMMIT;


--从界面取得变量并转换成特定格式的日期
VBEGINDATE :=TO_DATE('\(1,1)','YYYY.MM.DD');
VENDDATE :=TO_DATE('\(2,1)','YYYY.MM.DD');

INSERT INTO H4RTMP_BUY1SCHECK
(POSNO,FLOWNO,CASHIER,FILDATE,STDTOTAL,
SCRTOTAL,REALAMT,CARDNO,RECCNT,MEMO,
SCRFAVMODE,SCRFAVVALUE,DEALER,SCORE,RCVTIME,
CLASSDATE,CLASSNO,BUSDATE,CONTINUOUSFLOWNO)
SELECT
POSNO,FLOWNO,CASHIER,FILDATE,STDTOTAL,
SCRTOTAL,REALAMT,CARDNO,RECCNT,MEMO,
SCRFAVMODE,SCRFAVVALUE,DEALER,SCORE,RCVTIME,
CLASSDATE,CLASSNO,BUSDATE,CONTINUOUSFLOWNO
from buy1s
where 
((to_date(substr(flowno,1,8),'yyyy.mm.dd')>=VBEGINDATE
and to_date(substr(flowno,1,8),'yyyy.mm.dd')<VENDDATE)
or 
(trunc(fildate)>=VBEGINDATE and trunc(fildate)<VENDDATE))
and trunc(fildate)<>to_date(substr(flowno,1,8),'yyyy.mm.dd');
COMMIT;

UPDATE H4RTMP_BUY1SCHECK
SET CHECKBEGINDATE=VBEGINDATE,
CHECKENDDATE=VENDDATE;
COMMIT;

END;
</BEFORERUN>
<AFTERRUN>
</AFTERRUN>
<TABLELIST>
  <TABLEITEM>
    <TABLE>H4RTMP_BUY1SCHECK</TABLE>
    <ALIAS>H4RTMP_BUY1SCHECK</ALIAS>
    <INDEXNAME></INDEXNAME>
    <INDEXMETHOD></INDEXMETHOD>
  </TABLEITEM>
</TABLELIST>
<JOINLIST>
</JOINLIST>
<COLUMNLIST>
  <FIXEDCOLUMNS>0</FIXEDCOLUMNS>
  <COLUMNITEM>
    <AGGREGATION></AGGREGATION>
    <COLUMN>H4RTMP_BUY1SCHECK.POSNO</COLUMN>
    <TITLE>收银机编号</TITLE>
    <FIELDTYPE>1</FIELDTYPE>
    <VISIBLE>TRUE</VISIBLE>
    <GAGGREGATION></GAGGREGATION>
    <DISPLAYINNEXT>TRUE</DISPLAYINNEXT>
    <ISKEY>FALSE</ISKEY>
    <COLUMNNAME>POSNO</COLUMNNAME>
    <CFILTER>FALSE</CFILTER>
    <CFONTCOLOR>0</CFONTCOLOR>
    <CDISFORMAT></CDISFORMAT>
    <CGROUPINDEX>0</CGROUPINDEX>
  </COLUMNITEM>
  <COLUMNITEM>
    <AGGREGATION></AGGREGATION>
    <COLUMN>H4RTMP_BUY1SCHECK.FLOWNO</COLUMN>
    <TITLE>销售流水号</TITLE>
    <FIELDTYPE>1</FIELDTYPE>
    <VISIBLE>TRUE</VISIBLE>
    <GAGGREGATION></GAGGREGATION>
    <DISPLAYINNEXT>TRUE</DISPLAYINNEXT>
    <ISKEY>FALSE</ISKEY>
    <COLUMNNAME>FLOWNO</COLUMNNAME>
    <CFILTER>FALSE</CFILTER>
    <CFONTCOLOR>0</CFONTCOLOR>
    <CDISFORMAT></CDISFORMAT>
    <CGROUPINDEX>-1</CGROUPINDEX>
  </COLUMNITEM>
  <COLUMNITEM>
    <AGGREGATION></AGGREGATION>
    <COLUMN>H4RTMP_BUY1SCHECK.FILDATE</COLUMN>
    <TITLE>销售填单时间</TITLE>
    <FIELDTYPE>11</FIELDTYPE>
    <VISIBLE>TRUE</VISIBLE>
    <GAGGREGATION></GAGGREGATION>
    <DISPLAYINNEXT>TRUE</DISPLAYINNEXT>
    <ISKEY>FALSE</ISKEY>
    <COLUMNNAME>FILDATE</COLUMNNAME>
    <CFILTER>FALSE</CFILTER>
    <CFONTCOLOR>0</CFONTCOLOR>
    <CDISFORMAT></CDISFORMAT>
    <CGROUPINDEX>-1</CGROUPINDEX>
  </COLUMNITEM>
  <COLUMNITEM>
    <AGGREGATION></AGGREGATION>
    <COLUMN>H4RTMP_BUY1SCHECK.RCVTIME</COLUMN>
    <TITLE>系统接收时间</TITLE>
    <FIELDTYPE>11</FIELDTYPE>
    <VISIBLE>TRUE</VISIBLE>
    <GAGGREGATION></GAGGREGATION>
    <DISPLAYINNEXT>TRUE</DISPLAYINNEXT>
    <ISKEY>FALSE</ISKEY>
    <COLUMNNAME>RCVTIME</COLUMNNAME>
    <CFILTER>FALSE</CFILTER>
    <CFONTCOLOR>0</CFONTCOLOR>
    <CDISFORMAT></CDISFORMAT>
    <CGROUPINDEX>-1</CGROUPINDEX>
  </COLUMNITEM>
  <COLUMNITEM>
    <AGGREGATION></AGGREGATION>
    <COLUMN>H4RTMP_BUY1SCHECK.CHECKBEGINDATE</COLUMN>
    <TITLE>开始时间</TITLE>
    <FIELDTYPE>0</FIELDTYPE>
    <VISIBLE>FALSE</VISIBLE>
    <GAGGREGATION></GAGGREGATION>
    <DISPLAYINNEXT>FALSE</DISPLAYINNEXT>
    <ISKEY>FALSE</ISKEY>
    <COLUMNNAME>CHECKBEGINDATE</COLUMNNAME>
    <CFILTER>FALSE</CFILTER>
    <CFONTCOLOR>0</CFONTCOLOR>
    <CDISFORMAT></CDISFORMAT>
    <CGROUPINDEX>-1</CGROUPINDEX>
  </COLUMNITEM>
  <COLUMNITEM>
    <AGGREGATION></AGGREGATION>
    <COLUMN>H4RTMP_BUY1SCHECK.CHECKENDDATE</COLUMN>
    <TITLE>结束时间</TITLE>
    <FIELDTYPE>0</FIELDTYPE>
    <VISIBLE>FALSE</VISIBLE>
    <GAGGREGATION></GAGGREGATION>
    <DISPLAYINNEXT>FALSE</DISPLAYINNEXT>
    <ISKEY>FALSE</ISKEY>
    <COLUMNNAME>CHECKENDDATE</COLUMNNAME>
    <CFILTER>FALSE</CFILTER>
    <CFONTCOLOR>0</CFONTCOLOR>
    <CDISFORMAT></CDISFORMAT>
    <CGROUPINDEX>-1</CGROUPINDEX>
  </COLUMNITEM>
</COLUMNLIST>
<COLUMNWIDTH>
  <COLUMNWIDTHITEM>84</COLUMNWIDTHITEM>
  <COLUMNWIDTHITEM>130</COLUMNWIDTHITEM>
  <COLUMNWIDTHITEM>122</COLUMNWIDTHITEM>
  <COLUMNWIDTHITEM>174</COLUMNWIDTHITEM>
</COLUMNWIDTH>
<GROUPLIST>
</GROUPLIST>
<ORDERLIST>
  <ORDERITEM>
    <COLUMN>销售流水号</COLUMN>
    <ORDER>ASC</ORDER>
  </ORDERITEM>
  <ORDERITEM>
    <COLUMN>销售填单时间</COLUMN>
    <ORDER>ASC</ORDER>
  </ORDERITEM>
  <ORDERITEM>
    <COLUMN>系统接收时间</COLUMN>
    <ORDER>ASC</ORDER>
  </ORDERITEM>
  <ORDERITEM>
    <COLUMN>收银机编号</COLUMN>
    <ORDER>ASC</ORDER>
  </ORDERITEM>
</ORDERLIST>
<CRITERIALIST>
  <WIDTHLIST>
  </WIDTHLIST>
  <CRITERIAITEM>
    <LEFT>H4RTMP_BUY1SCHECK.CHECKBEGINDATE</LEFT>
    <OPERATOR>=</OPERATOR>
    <RIGHT>
      <RIGHTITEM>2010.10.04</RIGHTITEM>
      <RIGHTITEM></RIGHTITEM>
      <RIGHTITEM></RIGHTITEM>
      <RIGHTITEM></RIGHTITEM>
    </RIGHT>
    <ISHAVING>FALSE</ISHAVING>
    <ISQUOTED>2</ISQUOTED>
    <PICKNAME>
    </PICKNAME>
    <PICKVALUE>
    </PICKVALUE>
    <DEFAULTVALUE>昨天</DEFAULTVALUE>
    <ISREQUIRED>TRUE</ISREQUIRED>
    <WIDTH>0</WIDTH>
  </CRITERIAITEM>
  <CRITERIAITEM>
    <LEFT>H4RTMP_BUY1SCHECK.CHECKENDDATE</LEFT>
    <OPERATOR>=</OPERATOR>
    <RIGHT>
      <RIGHTITEM>2010.10.06</RIGHTITEM>
      <RIGHTITEM></RIGHTITEM>
      <RIGHTITEM></RIGHTITEM>
      <RIGHTITEM></RIGHTITEM>
    </RIGHT>
    <ISHAVING>FALSE</ISHAVING>
    <ISQUOTED>2</ISQUOTED>
    <PICKNAME>
    </PICKNAME>
    <PICKVALUE>
    </PICKVALUE>
    <DEFAULTVALUE>明天</DEFAULTVALUE>
    <ISREQUIRED>TRUE</ISREQUIRED>
    <WIDTH>0</WIDTH>
  </CRITERIAITEM>
</CRITERIALIST>
<CRITERIAWIDTH>
  <CRITERIAWIDTHITEM>125</CRITERIAWIDTHITEM>
  <CRITERIAWIDTHITEM>139</CRITERIAWIDTHITEM>
</CRITERIAWIDTH>
<SG>
  <LINE>
  </LINE>
  <LINE>
    <SGLINEITEM>条件 1：</SGLINEITEM>
    <SGLINEITEM>2010.10.04</SGLINEITEM>
    <SGLINEITEM>2010.10.06</SGLINEITEM>
  </LINE>
  <LINE>
    <SGLINEITEM>  或 2：</SGLINEITEM>
    <SGLINEITEM></SGLINEITEM>
    <SGLINEITEM></SGLINEITEM>
  </LINE>
  <LINE>
    <SGLINEITEM>  或 3：</SGLINEITEM>
    <SGLINEITEM></SGLINEITEM>
    <SGLINEITEM></SGLINEITEM>
  </LINE>
  <LINE>
    <SGLINEITEM>  或 4：</SGLINEITEM>
    <SGLINEITEM></SGLINEITEM>
    <SGLINEITEM></SGLINEITEM>
  </LINE>
  <LINE>
  </LINE>
</SG>
<CHECKLIST>
  <CAPTION>
  </CAPTION>
  <EXPRESSION>
  </EXPRESSION>
  <CHECKED>
  </CHECKED>
  <ANDOR> and </ANDOR>
</CHECKLIST>
<UNIONLIST>
</UNIONLIST>
<NCRITERIAS>
  <NUMOFNEXTQRY>0</NUMOFNEXTQRY>
</NCRITERIAS>
<MULTIQUERIES>
  <NUMOFMULTIQRY>0</NUMOFMULTIQRY>
</MULTIQUERIES>
<FUNCTIONLIST>
</FUNCTIONLIST>
<DXDBGRIDITEM>
  <DXLOADMETHOD>TRUE</DXLOADMETHOD>
  <DXSHOWGROUP>FALSE</DXSHOWGROUP>
  <DXSHOWFOOTER>FALSE</DXSHOWFOOTER>
  <DXSHOWSUMMARY>FALSE</DXSHOWSUMMARY>
  <DXSHOWPREVIEW>FALSE</DXSHOWPREVIEW>
  <DXSHOWFILTER>FALSE</DXSHOWFILTER>
  <DXPREVIEWFIELD></DXPREVIEWFIELD>
  <DXCOLORODDROW>-2147483643</DXCOLORODDROW>
  <DXCOLOREVENROW>12632256</DXCOLOREVENROW>
  <DXFILTERNAME></DXFILTERNAME>
  <DXFILTERLIST>
  </DXFILTERLIST>
  <DXSHOWGRIDLINE>1</DXSHOWGRIDLINE>
</DXDBGRIDITEM>
</SQLQUERY>
<SQLREPORT>
<RPTTITLE></RPTTITLE>
<RPTGROUPCOUNT>0</RPTGROUPCOUNT>
<RPTGROUPLIST>
</RPTGROUPLIST>
<RPTCOLUMNCOUNT>0</RPTCOLUMNCOUNT>
<RPTCOLUMNWIDTHLIST>
</RPTCOLUMNWIDTHLIST>
<RPTLEFTMARGIN>20</RPTLEFTMARGIN>
<RPTORIENTATION>0</RPTORIENTATION>
<RPTCOLUMNS>1</RPTCOLUMNS>
<RPTHEADERLEVEL>0</RPTHEADERLEVEL>
<RPTPRINTCRITERIA>TRUE</RPTPRINTCRITERIA>
<RPTVERSION></RPTVERSION>
<RPTNOTE></RPTNOTE>
<RPTFONTSIZE>10</RPTFONTSIZE>
<RPTLINEHEIGHT>宋体</RPTLINEHEIGHT>
<RPTPAGEHEIGHT>66</RPTPAGEHEIGHT>
<RPTPAGEWIDTH>80</RPTPAGEWIDTH>
<RPTTITLETYPE>0</RPTTITLETYPE>
<RPTCURREPORT></RPTCURREPORT>
<RPTREPORTLIST>
</RPTREPORTLIST>
</SQLREPORT>

